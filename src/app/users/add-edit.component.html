<h1 *ngIf="isAddMode">Benutzer hinzufügen</h1>
<h1 *ngIf="!isAddMode">Benutzer editieren</h1>
<form novalidate #form="ngForm" (ngSubmit)="onSubmit(form)">
    <div class="form-row">
        <div class="form-group col">
          <mat-form-field appearance="fill">
            <mat-label>Benutzer</mat-label>
            <input matInput ngModel type="text" name="username" [(ngModel)]="user.username" placeholder="Benutzer"
               required minlength="3" maxlength="20" #username="ngModel">
            <mat-hint align="end">{{user.username?.length || 0}}/20</mat-hint>
            <mat-error *ngIf="username.dirty && form.invalid">
              Benutzernamen ist erforderlich
            </mat-error>
            <mat-error *ngIf="username.hasError('minlength')">
              Benutzernamen muss mindestens 3 Zeichen enthalten
            </mat-error>
            <mat-error *ngIf="username.hasError('maxlength')">
              Benutzernamen darf maximal 20 Zeichen enthalten
            </mat-error>
          </mat-form-field>
        </div>
       <div class="form-group col">
        <mat-form-field appearance="fill">
          <mat-label>eMail</mat-label>
          <input matInput ngModel type="text" name="email" [(ngModel)]="user.email" placeholder="eMail"
                 required #email="ngModel" pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,4}$">
          <mat-error *ngIf="email.dirty && email.invalid">
            Bitte eine gültige eMail Adresse eingeben
          </mat-error>
        </mat-form-field>
      </div>
     <div class="form-group col">
       <mat-form-field appearance="fill">
       <mat-label>Benutzer Rolle</mat-label>
        <mat-select placeholder="Rolle" [(ngModel)]="user.role" name="role" required #role="ngModel">
          <mat-option *ngFor="let item of roles" [value]="item.title" >{{item.value}}</mat-option>
        </mat-select>
       <mat-error *ngIf="role.hasError('minlength')">
         Rolle muss gewählt sein
       </mat-error>
       </mat-form-field>
     </div>
     <div class="form-group col">
          <mat-form-field appearance="fill">
            <mat-label>Passwort</mat-label>
            <input matInput ngModel [type]="hidePwd ? 'password' : 'text'" name="password" [(ngModel)]="user.password" placeholder="Passwort"
                   required minlength="8" maxlength="20" [errorStateMatcher]="matcher" #password="ngModel">
            <mat-hint align="end">{{user.password?.length || 0}}/20</mat-hint>
            <button mat-icon-button matSuffix (click)="hidePwd = !hidePwd" [attr.aria-label]="'Hide password'" [attr.aria-pressed]="hidePwd">
              <mat-icon>{{hidePwd ? 'visibility_off' : 'visibility'}}</mat-icon>
            </button>
            <mat-error *ngIf="password.hasError('required')">
              Passwort ist erforderlich
            </mat-error>
            <mat-error *ngIf="password.hasError('minlength')">
              Passwort muss mindestens 8 Zeichen enthalten
            </mat-error>
            <mat-error *ngIf="password.hasError('maxlength')">
              Passwort darf maximal 20 Zeichen enthalten
            </mat-error>
          </mat-form-field>
          <password-strength-meter [password]="password.value" [enableFeedback]="false"></password-strength-meter>

          <small id="passwordHelpBlock" class="form-text text-muted">
            Das Passwort muss 8-20 Zeichen lang sein, Buchstaben und Zahlen und darf keine Leerzeichen enthalten.
          </small>
        </div>
    </div>
    <div class="form-group">
      <a mat-stroked-button routerLink="/users" class="btn btn-link">Abbrechen</a>

      <button [disabled]="loading || !form.form.valid" mat-stroked-button type="submit">
        <span *ngIf="loading" class="spinner-border spinner-border-sm mr-1"></span>
        Speichern
      </button>
    </div>
</form>
